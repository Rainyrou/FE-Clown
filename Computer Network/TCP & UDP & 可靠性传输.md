TCP 是一种面向连接的协议，通信双方在数据传输前必须建立连接，其通过三次握手、确认应答、超时重传、流量控制、拥塞控制和保活机制等确保数据的可靠性传输

UDP 是一种面向报文的协议，无需在数据传输前建立连接即无需握手，无法保证数据的可靠性传输即数据可能丢包或顺序错乱且没有内建的错误纠正机制，发送方发送的各个报文在接收方都是独立接收的，其支持多播和广播，可同时发送数据给多个接收方

- 连接方式：TCP 是面向连接的，UDP 是无连接的
- 可靠性：TCP 通过三次握手、确认应答、超时重传、流量控制、拥塞控制和保活机制等确保数据的可靠性传输
  且以正确顺序到达接收方，UDP 无法保证数据的可靠性传输即数据可能丢包或顺序错乱且没有内建的错误纠正机制
- 传输速度：由于建立连接和确保数据的可靠性传输，TCP 传输速度比 UDP 慢
- 用途：TCP 用于数据可靠性传输的应用如 Web 页面加载和文件传输等，而 UDP 用于实时应用如流媒体和在线游戏等

###### TCP 可靠性传输

1. 三次握手

- 第一次握手：客户端发送 SYN 同步序列报文以开始连接
- 第二次握手：服务端返回 SYN-ACK 同步应答报文以确认接收到 SYN 报文
- 第三次握手：客户端发送 ACK 确认报文以确认接收到 SYN-ACK 报文

2. 确认应答 & 超时重传：给各个 TCP 包分配唯一序列号，保证数据按照发送顺序到达接收方，接收方可通过序列号检测丢包和重排包序，当发送方发送数据段后立即启动定时器，接收方接收到数据段后返回 ACK 报文，若在定时器超时前发送方未接收到相应的 ACK 报文，超时重传该数据段

3. 流量控制：通过滑动窗口机制以控制流量，避免接收方的缓冲区溢出，接收方在 ACK 报文中指定窗口大小以通知发送方其所能接收的数据量，发送方的滑动窗口大小根据接收方的接收窗口和网络的拥塞窗口之最小值动态调整

- 滑动窗口大：当网络状态良好且接收方缓冲区足够大时，滑动窗口变大，允许更多数据在确认前发送
- 滑动窗口小：当网络拥塞或接收方缓冲区接近溢出时，滑动窗口变小，限制发送方在等待接收方确认前可发送的数据量

4. 拥塞控制：发送方通过拥塞窗口动态调整发送速率以避免网络拥堵

- 慢启动：建立连接初期，拥塞窗口从一个较小值开始，每接收一个 ACK 报文，增加一个 MSS（呈指数增长）
- 拥塞避免：当达到慢启动阈值时，拥塞窗口每经过一个往返时间，增加一个 MSS（呈线性增长）
- 快重传：当发送方接收到三个及以上的重复 ACK 报文时，其立即重传丢包而非等待定时器超时
- 快恢复：当进入快重传阶段时，拥塞窗口减半，并将慢启动阈值设置为新的拥塞窗口大小。拥塞窗口每接收到重复 ACK 报文，增加一个 MSS，直到接收到新的 ACK 报文，而一旦接收到新的 ACK 报文，拥塞窗口大小重置为慢启动阈值，进入拥塞避免阶段

5. 保活机制 Keepalive：若在指定的时间内，连接上无任何数据传输，发送方定期自动发送 Keepalive 探针检测接收方是否响应以确认连接的有效性，若在指定时间内未接收到响应，则 TCP 自动关闭连接
