通过 TCP 三次握手与服务端建立连接，进行通信

![[Pasted image 20231030070246.png]]

客户端和服务端初始时为 CLOSED 状态。服务端主动监听某个端口，处于 LISTEN 状态

![[Pasted image 20231030070719.png]]

客户端随机初始化序号 client_isn ，将此序号置于 TCP 首部的|序号|字段中，同时将 SYN 置为 1，接着将第 1 个 SYN 报文发送给服务端，该报文不含应用层数据，此时客户端处于 SYN-SENT 状态

![[Pasted image 20231030070656.png]]

服务端接收到客户端的 SYN 报文后，它随机初始化序号 server_isn，将此序号填入
TCP 首部的|序号|字段中，再将 client_isn + 1 填入|确认应答号|字段，将 SYN 和 ACK 置为 1，接着将该报文返回给客户端，该报文不含应用层数据，此时服务端处于 SYN-RCVD 状态

![[Pasted image 20231030070934.png]]

客户端接收到服务端报文后，向服务端发送最后一个应答报文，将 ACK 置为 1 ，再将 server_isn + 1 填入|确认应答号|字段，该报文可含应用层数据，此时客户端处于 ESTABLISHED 状态，服务端接收到客户端的应答报文后，进入 ESTABLISHED 状态

一旦完成三次握手，客户端和服务端即可进行通信，此后可通过四次挥手断开连接

![[Pasted image 20231030071543.png]]

- 客户端打算关闭连接，发送一个 FIN 置为 1 的报文，客户端进入 FIN_WAIT_1 状态
- 服务端接收到该报文后，向客户端返回 ACK 应答报文，服务端进入 CLOSED_WAIT 状态
- 客户端接收到该报文后，进入 FIN_WAIT_2 状态
- 服务端处理完数据后，向客户端发送 FIN 报文，服务端进入 LAST_ACK 状态
- 客户端接收到该报文后，向服务端返回 ACK 应答报文，客户端进入 TIME_WAIT 状态
- 服务器接收到该报文后，进入 CLOSED 状态
- 客户端经过 2MSL 后，进入 CLOSED 状态
