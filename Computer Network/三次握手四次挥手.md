通过 TCP 三次握手与服务端建立连接，进行数据传输

![[Pasted image 20231030070246.png]]

客户端和服务端初始时为 CLOSED 状态。服务端主动监听某个端口，处于 LISTEN 状态

![[Pasted image 20231030070719.png]]

客户端随机初始化序号( client_isn） ，将此序号置于 TCP 首部的|序号|字段中，同时把 SYN 标志为 1 。接着把第一个 SYN 报文发送给服务端，该报文不含应用层数据，此时客户端处于 SYN-SENT 状态

![[Pasted image 20231030070656.png]]

服务端接收到客户端的 SYN 报文后，它随机初始化自己的序号 ( server_isn )，将此序号填入
TCP 首部的|序号|字段中，再把 TCP 首部的|确认应答号|字段填入 client_isn + 1，接着把 SYN 和 ACK 标志为 1。再将该报文返回给客户端，该报文不含应用层数据，此时服务端处于 SYN-RCVD 状态

![[Pasted image 20231030070934.png]]

客户端收到服务端报文后，向服务端发送最后一个应答报文，该应答报文 TCP 首部 ACK 标志为 1 ，|确认应答号|字段填入 server_isn + 1 ，该报文可包含应用层数据，此时客户端处于 ESTABLISHED 状态。服务器接收客户端的应答报文后，也进入 ESTABLISHED 状态

一旦完成三次握手，客户端和服务端可以相互发送数据了。数据传输完成后，通过四次挥手来断开连接

![[Pasted image 20231030071543.png]]

- 客户端打算关闭连接，此时发送一个 TCP 首部 FIN 标志为 1 的报文，也即 FIN 报文，此时客户端进入 FIN_WAIT_1 状态
- 服务端接收到该报文后，向客户端发送 ACK 应答报文，此时服务端进入 CLOSED_WAIT 状态
- 客户端接收到服务端的 ACK 应答报文后，此时进入 FIN_WAIT_2 状态
- 等待服务端处理完数据后，向客户端发送 FIN 报文，此时服务端进入 LAST_ACK 状态
- 客户端接收到服务端的 FIN 报文后，返回一个 ACK 应答报文，此时进入 TIME_WAIT 状态
- 服务器接收到 ACK 应答报文后，此时进入 CLOSED 状态
- 客户端在经过 2MSL 一段时间后，自动进入 CLOSED 状态
