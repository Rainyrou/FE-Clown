性能优化与体验优化确实是两个不同的概念，性能优化关注的是技术指标的改进，如加载时间、渲染速度等，而体验优化更侧重于用户的感知，包括但不限于页面交互的流畅性等。性能优化是手段，体验优化才是目的

建立量化指标是为了使性能优化有更明确的方向和目标，同时提供一种客观衡量优化效果的方法。在没有量化指标的情况下，我们很难判断优化是否有效，或者优化到了什么程度。量化指标让我们可以明确知道优化前后的性能差异，这对于评估优化的成本与收益、决定优化的优先级等都至关重要。主观体验量化为客观指标是一个不小的挑战，因为它需要找到能准确反映用户体验的技术指标

- 绝不生搬硬套，反向优化
- 结果导向，量化指标，改善用户体验
- 开发体验和用户体验成正相关
- 持续维护，不搞 KPI

##### 动态懒加载

按道理，我的玩具项目应该是加载飞起，但实际上相应有点慢。于是我通过 Rollup 插件 `rollup-plugin-visualizer` 寻找突破口，当你在命令行执行 `npm run build`，它会生成项目依赖关系的可视化图表。我发现验证码 `captchaRef` 仅在注册页面上使用一次，但它的依赖项 lodash.js 却占了 30.25%，这严重影响页面加载性能。于是我想到了动态懒加载，在 React 官方文档找到相应解决方案，使用 `lazy` 和 `Suspense` 实现组件的动态懒加载

`src/container/Login/index.jsx`

```JSX
const Captcha = React.lazy(() => import("react-captcha-code"))

<Suspense fallback={<div>Loading...</div>}>
	<Captcha ref={captchaRef} charNum={4} onChange={handleChange} />
</Suspense>
```

##### 按需引入

###### 全局引入

![[1699059624799.png]]

###### 按需引入（具体操作见 GitHub 第 5 次 commit）

思路来源：Element Plus [快速开始 | Element Plus](https://element-plus.org/zh-CN/guide/quickstart.html#%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5)

只有在使用某个组件时，该组件的 CSS 才会被加载和打包

查阅掘金、npm 源码、GitHub 和 Zarm 文档解决了版本冲突并在 `vite.config.js` 中正确的修改了配置 `vite-plugin-style-import`，确保最终测得 CSS 打包体积减少 41%

![[1699067268487.png]]

##### 识别性能瓶颈

1. 详细分析 Lighthouse 和 WebPageTest 的报告，识别具体的性能问题
2. 设定性能预算，如最大页面加载时间、资源大小限制等
3. 使用 React DevTools 分析组件渲染性能，避免不必要的渲染
4. 优化数据获取和状态管理，减少不必要的状态变化
5. 代码审查和重构屎山 or 有 bug 的代码
