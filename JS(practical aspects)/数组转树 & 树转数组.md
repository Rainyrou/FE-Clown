###### 数组转树：

递归：

```js
const arrayToTree = (data, pid) => {
  const result = [];
  getChildren(data, result, pid);
  return result;
};

const getChildren = (data, result, pid) => {
  for (const item of data) {
    if (item.pid === pid) {
      const newItem = { ...item, children: [] };
      result.push(newItem);
      getChildren(data, newItem.children, item.id);
    }
  }
};

const testData = [
  { id: 1, name: "根节点1", pid: null },
  { id: 2, name: "根节点2", pid: null },
  { id: 3, name: "子节点1-1", pid: 1 },
  { id: 4, name: "子节点1-2", pid: 1 },
  { id: 5, name: "子节点2-1", pid: 2 },
  { id: 6, name: "子节点2-2", pid: 2 },
  { id: 7, name: "子节点1-1-1", pid: 3 },
  { id: 8, name: "子节点2-1-1", pid: 5 },
];

console.log(JSON.stringify(arrayToTree(testData, null), null, 2));
```

非递归：

```JavaScript
const arrayToTree = (data) => {
  const result = [];
  let map = {};
  for (const item of data) {
    let id = item.id,
      pid = item.pid;
    if (!map[id]) map[id] = { children: [] };
    map[id] = { ...item, children: map[id].children };
    if (!pid) {
      result.push(map[id]);
    } else {
      if (!map[pid]) map[pid] = { children: [] };
      map[pid].children.push(map[id]);
    }
  }
  return result;
};

const testData = [
  { id: 1, name: "根节点1", pid: null },
  { id: 2, name: "根节点2", pid: null },
  { id: 3, name: "子节点1-1", pid: 1 },
  { id: 4, name: "子节点1-2", pid: 1 },
  { id: 5, name: "子节点2-1", pid: 2 },
  { id: 6, name: "子节点2-2", pid: 2 },
  { id: 7, name: "子节点1-1-1", pid: 3 },
  { id: 8, name: "子节点2-1-1", pid: 5 },
];

console.log(JSON.stringify(arrayToTree(testData), null, 2));
```

正确的输出结果：

```json
[
  {
    "id": 1,
    "name": "根节点1",
    "pid": null,
    "children": [
      {
        "id": 3,
        "name": "子节点1-1",
        "pid": 1,
        "children": [
          {
            "id": 7,
            "name": "子节点1-1-1",
            "pid": 3,
            "children": []
          }
        ]
      },
      {
        "id": 4,
        "name": "子节点1-2",
        "pid": 1,
        "children": []
      }
    ]
  },
  {
    "id": 2,
    "name": "根节点2",
    "pid": null,
    "children": [
      {
        "id": 5,
        "name": "子节点2-1",
        "pid": 2,
        "children": [
          {
            "id": 8,
            "name": "子节点2-1-1",
            "pid": 5,
            "children": []
          }
        ]
      },
      {
        "id": 6,
        "name": "子节点2-2",
        "pid": 2,
        "children": []
      }
    ]
  }
]
```

时间复杂度为 O(n)

1. id (Identifier)：节点的唯一标识
2. pid (Parent Identifier)：节点的父节点对应的 `id`，若节点为顶级元素即无父节点，其 `pid` 被设置为一个特定值如 `0`、`null` 或 `undefined`

###### 树转数组

```js
const treeToArray = (data) => {
  let result = [];
  data.forEach((item) => {
    result.push(item);
    if (item.children) {
      result = result.concat(treeToArray(item.children));
      delete item.children;
    }
  });
  return result;
};

const testData = [
  {
    id: 1,
    name: "根节点1",
    pid: null,
    children: [
      {
        id: 3,
        name: "子节点1-1",
        pid: 1,
        children: [
          {
            id: 7,
            name: "子节点1-1-1",
            pid: 3,
            children: [],
          },
        ],
      },
      {
        id: 4,
        name: "子节点1-2",
        pid: 1,
        children: [],
      },
    ],
  },
  {
    id: 2,
    name: "根节点2",
    pid: null,
    children: [
      {
        id: 5,
        name: "子节点2-1",
        pid: 2,
        children: [
          {
            id: 8,
            name: "子节点2-1-1",
            pid: 5,
            children: [],
          },
        ],
      },
      {
        id: 6,
        name: "子节点2-2",
        pid: 2,
        children: [],
      },
    ],
  },
];

console.log(treeToArray(testData));
```

输出结果

```json
[
  { id: 1, name: '根节点1', pid: null },
  { id: 3, name: '子节点1-1', pid: 1 },
  { id: 7, name: '子节点1-1-1', pid: 3 },
  { id: 4, name: '子节点1-2', pid: 1 },
  { id: 2, name: '根节点2', pid: null },
  { id: 5, name: '子节点2-1', pid: 2 },
  { id: 8, name: '子节点2-1-1', pid: 5 },
  { id: 6, name: '子节点2-2', pid: 2 }
]
```

